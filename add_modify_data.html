<!DOCTYPE html>
<html lang="en">
<head>
    <title>Radical Wreckage</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="radicalWreckage.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Roboto:wght@900&display=swap');
    </style>
</head>
<body>
    <header>
        <section class="grid4">
            <div class="nadiv">
                <nav>
                    <ul>
                        <li>
                            <a href="index.html">HOME</a>
                        </li>
                        <li>
                            <a href="contact_us.html">CONTACT US</a>
                        </li>
                        <li>
                            <a href="hours_location.html">HOURS & LOCATION</a>
                        </li>
                        <li>
                            <a href="add_modify_data.html">ADD & MODIFY DATA</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="logo_image">
                <img src="images/radical_image.png" alt="radical_wreckage_logo" id="logo">
            </div>
            <div class="portrait_of_jerrad_mouse_jensen">
                <img src="images/jerrad_mouse_jensen_image.png" alt="portrait_of_jerrad_mouse_jensen" id="jerrad">
            </div>
            

    </header>
   
<div class="modify_purple">
<h1 class="modify_white">ADD CAR to DATABASE: </h1>
    
</div>
    
    
    
<form class="myImages" onsubmit="add_car_data(); return false;" id="add_form"> 
    <section class="background">
            <fieldset>
            <h1 class="maker_modify">Existing Car Maker</h1>
                <div class="all_makes">
                    <select name="car_make" id="maker_new">
                        <option value="Acura">acura</option>
                        <option value="Audi">Audi</option>
                        <option value="Buick">Buick</option>
                        <option value="Chevrolet">Chevrolet</option>
                        <option value="Dodge">Dodge</option>
                        <option value="Ford">Ford </option>
                        <option value="GMC">GMC </option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="International">International</option>
                        <option value="Kia">Kia</option>
                        <option value="Land_Rover">Land Rover</option>
                        <option value="Lincoln">Lincoln</option>
                        <option value="Mecury">Mecury</op8tion>
                        <option value="Nissan">Nissan</option>
                        <option value="Pontiac">Pontiac</option>
                        <option value="Saturn">Saturn</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Tesla">Tesla</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Volksvagon">Volkswagon</option>
                    </Select>

                
                
                </div>
            </fieldset>

        <section class="background">
            <fieldset>
            <div class="year_of_car">
                <H2>ENTER A YEAR:</H2>
                <select name="years" id="new_car_year">
                    <option value="1950"> 1950</option>
                    <option value="1951"> 1951</option>
                    <option value="1952"> 1952</option>
                    <option value="1953"> 1953</option>
                    <option value="1954"> 1954</option>
                    <option value="1955"> 1955</option>
                    <option value="1956"> 1956</option>
                    <option value="1957"> 1957</option>
                    <option value="1958"> 1958</option>
                    <option value="1959"> 1959</option>
                    <option value="1960"> 1960</option>
                    <option value="1961"> 1961</option>
                    <option value="1962"> 1962</option>
                    <option value="1963"> 1963</option>
                    <option value="1964"> 1964</option>
                    <option value="1965"> 1965</option>
                    <option value="1966"> 1966</option>
                    <option value="1967"> 1967</option>
                    <option value="1968"> 1968</option>
                    <option value="1969"> 1969</option>
                    <option value="1970"> 1970</option>
                    <option value="1971"> 1971</option>
                    <option value="1972"> 1972</option>
                    <option value="1973"> 1973</option>
                    <option value="1974"> 1974</option>
                    <option value="1975"> 1975</option>
                    <option value="1976"> 1976</option>
                    <option value="1977"> 1977</option>
                    <option value="1978"> 1978</option>
                    <option value="1979"> 1979</option>
                    <option value="1980"> 1980</option>
                    <option value="1981"> 1981</option>
                    <option value="1982"> 1982</option>
                    <option value="1983"> 1983</option>
                    <option value="1984"> 1984</option>
                    <option value="1985"> 1985</option>
                    <option value="1986"> 1986</option>
                    <option value="1987"> 1987</option>
                    <option value="1988"> 1988</option>
                    <option value="1989"> 1989</option>
                    <option value="1990"> 1990</option>
                    <option value="1991"> 1991</option>
                    <option value="1992"> 1992</option>
                    <option value="1993"> 1993</option>
                    <option value="1994"> 1994</option>
                    <option value="1995"> 1995</option>
                    <option value="1996"> 1996</option>
                    <option value="1997"> 1997</option>
                    <option value="1998"> 1998</option>
                    <option value="1999"> 1999</option>
                    <option value="2000"> 2000</option>
                    <option value="2001"> 2001</option>
                    <option value="2002"> 2002</option>
                    <option value="2003"> 2003</option>
                    <option value="2004"> 2004</option>
                    <option value="2005"> 2005</option>
                    <option value="2006"> 2006</option>
                    <option value="2007"> 2007</option>
                    <option value="2008"> 2008</option>
                    <option value="2009"> 2009</option>
                    <option value="2010"> 2010</option>
                    <option value="2011"> 2011</option>
                    <option value="2012"> 2012</option>
                    <option value="2013"> 2013</option>
                    <option value="2014"> 2014</option>
                    <option value="2015"> 2015</option>
                    <option value="2016"> 2016</option>
                    <option value="2017"> 2017</option>
                    <option value="2018"> 2018</option>
                    <option value="2019"> 2019</option>
                    <option value="2020"> 2020</option>
                    <option value="2021"> 2021</option>
                    <option value="2022"> 2022</option>
                    <option value="2023"> 2023</option>
                    <option value="2024"> 2024</option>
                    <option value="2025"> 2025</option>
                </select>
            </div>
        </fieldset>
        </section>
   
        <section class="background">
            <fieldset>
            <div class="new_car" id="new_car"></div>
                <h2>Model( Name ONLY ):</h2>
                
                    <label for="new_car_description"></label>
                    <textarea name="new_car_description" id="car_model_description" cols="10" rows="1">Neon</textarea> 
                </fieldset>
        </section>
        
        <section class="background">
            <fieldset>
                <h3>Upload Images:</h3>
                <div class="image_upload">
                    <input type="file" name="image_name" id="new_car_image1">
                    <input type="file" name="image_name" id="new_car_image2">
                    <input type="file" name="image_name" id="new_car_image3">
                    <input type="file" name="image_name" id="new_car_image4">
                    <input type="submit" value="Attach-Photos" id="photos">
                </div>
            </fieldset>
        </section> 
                <br>
               
                <section class="background">
                    <fieldset>

                    
                        <div class="color" id="new-paint-color"></div>
                            <h2>Paint Color:</h2>
                            <select name="color_description" id="color_description">
                                <option value="red"> red</option>
                                <option value="orange"> orange</option>
                                <option value="yellow"> yellow</option>
                                <option value="pearl"> pearl</option>
                                <option value="white"> white</option>
                                <option value="gold"> gold</option>
                                <option value="green"> green</option>
                                <option value="blue-green"> blue-green</option>
                                <option value="blue"> blue</option>
                                <option value="light-blue"> light-blue</option>
                                <option value="maroon"> maroon</option>
                                <option value="purple"> purple</option>
                                <option value="fuscia"> fuscia</option>
                                <option value="pink"> pink</option>
                                <option value="gray"> gray</option>
                                <option value="silver"> silver</option>
                                <option value="black">  black</option>
                                <option value="brown"> brown</option>
                                <option value="tan"> tan</option>
                                <option value="cream">cream</option>
                            </select>
                        </section>
                        <div>
                            <section class="background">
                            <h3>Asking Price:</h3>
                                <label for="asking_price"></label>
                                <textarea name="asking_price" id="cost" cols="10" rows="1">ie: (8k/obo)</textarea>
                            </section>      
                        </div>
                    </fieldset>
                
    <button id="result_btn">ADD A NEW CAR</button>
</form>

<section>
<form class="myNewMake" onsubmit="addCarMakes(event); return false;" id="add_maker"> 

    <fieldset>
        
             <h2>Add a new Maker to the Database: </h2>
                
                    <label for="new_make_description"></label>
                    <textarea name="new_make_description" id="car_make_description" cols="10" rows="1">Land Rover</textarea> 
        
                    <button class="modify_make_btn" onclick="add_new_make()">ADD NEW MAKER</button>

        </section>        
    </fieldset>
</form>

    
    <h1>Find a car to that has been SOLD or you need to DELETE from the database HERE:  </h1>
    
<div class="content">
    <section class="searchbox">
                <fieldset>
                    <div>
                    <h2>FIND A CAR:</h2>
                    </div>
                    <br>
                    <br>
                    <div class="makes" id="makes_div">
                        <h2>Select AUTO MAKER(s):</h2>
                    </div>
                    <br>
                    <br>
                    <div class="model" id="modelDiv">
                    </div>
                    <br>
                    <br>
                    <div class="years" id="yearsDiv">    
                    </div>
                    <br>
                    <br>
                    <div class="images" id="imageContainer"></div>
                    </div>
           
            <h2>Search Results:</h2> 
            
                    <p></p>
                        <button class="delete_btn" id="del_btn" onclick="import_delete_car_by_id();  return false;">Permanently DELETE</button>
            </fieldset>
        </section>
    </div>
            

    </div>
    
    <footer>
        <section class="grid2" id="add_footer">
            <div class="footer_box1">
                <div class="social_fb_icon">
                    <a href="https://www.facebook.com/"><img id="fb" src="images/fb_svg.jpg" alt="facebook_icon"></a>
                </div>
                <div class="contact_us">
                    <button class="footer_contact_us" id="contact_btn">CONTACT US</button>
                </div>
                <div class="conclusion1"><p>&copy; Bowers inc. 2024</p>
                </div>
            </div>
        </section>
        </footer>

        <script>
        async function add_new_make(){
            console.log("Entering add new make");
            try {
                // Get every htmtl element you need here and store the values in local
                // variable (color, make, model, etc.), just like make make description below
                var textarea = document.getElementById("car_make_description");
                var text = textarea.value;
                //make sure you call the right http endpoint add_car_data for adding a new car
                // or add_car_makes for adding a new make
                const response = await fetch('http://127.0.0.1:5000/add_car_makes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Change this line to have all the values you need for your car
                    body: JSON.stringify({"car_make_description":text})
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function add_car_data(){
            console.log("Entering add new car");
            try {
                // Get every htmtl element you need here and store the values in local
                // variable (color, make, model, etc.), just like make make description below
                var makeSelect = document.getElementById("maker_new");
                // Get the selected option
                var selectedOption = makeSelect.options[makeSelect.selectedIndex];
                var make_text = selectedOption.text;
                var yearSelect = document.getElementById("new_car_year");
                selectedOption = yearSelect.options[yearSelect.selectedIndex];
                var year_text = selectedOption.text; 
                var textarea = document.getElementById("car_model_description");
                var model_text = textarea.value;
                var colorSelect = document.getElementById("color_description");
                selectedOption = colorSelect.options[colorSelect.selectedIndex];
                var color_text = selectedOption.text; 
                var textarea = document.getElementById("cost");
                var cost_text = textarea.value;
                var front = "front"; // TODO: generate unique names for these images
                var rear = "rear";
                var driver = "driver";
                var passenger = "passenger";

                var fileName = document.getElementById("new_car_image1");
                var text = textarea.value;
                var fileName = document.getElementById("new_car_image2");
                var text = textarea.value;
                var fileName = document.getElementById("new_car_image3");
                var text = textarea.value;
                var fileName = document.getElementById("new_car_image4");
                var text = textarea.value;

                //make sure you call the right http endpoint add_car_data for adding a new car
                // or add_car_makes for adding a new make
                const response = await fetch('http://127.0.0.1:5000/add_car_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Change this line to have all the values you need for your car
                    body: JSON.stringify({"make_name":make_text,"year":year_text,"model":model_text,"driver_side_image":driver,"passenger_side_image":passenger,"rear_view_image":rear,"front_view_image":front,"color":color_text,"cost":cost_text, "sold":null})
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        //document.getElementById('addCarForm').addEventListener('submit', async (event) => {
        //  event.preventDefault();
        //  look at the green comment above and follow the same format.  
        //}

        // Get the button element by its ID
        var button = document.getElementById('contact_btn');

        // Add a click event listener to the button
        button.addEventListener('click', function() {
        // Set the new URL you want to navigate to
        var newUrl = 'contact_us.html';

        // Change the window location to the new URL
        window.location.href = newUrl;
        });
        function addCarYears() {
            const selectedMake = document.querySelector('input[name="carMake"]:checked');
            var selectElement = document.getElementById("modelSelector");
            // Get the selected option
            var selectedOption = selectElement.options[selectElement.selectedIndex];
            var selectedModel = selectedOption.text;
            if (selectedMake) {
                const makeValue = selectedMake.value;
                fetch(`http://127.0.0.1:5000/car/${makeValue}/${selectedModel}`) // Update the URL to your endpoint
                    .then(response => response.json())
                    .then(data => {
                        // Handle the JSON data here
                        console.log('Car Years:', data);

                        // Example: Create checkboxes dynamically
                        const  yearsDiv = document.getElementById('yearsDiv');
                        yearsDiv.innerHTML = '<H3>SELECT A YEAR:</H3>';
                        const yearSelector = document.createElement('select');
                        yearSelector.id = 'yearSelector';
                        yearSelector.onchange = displayCar;
                        yearSelector.onclick = displayCar;
                        data.forEach(year_tuple => {
                                // add options to modelSelector
                                const option = document.createElement('option');
                                option.innerText = year_tuple[0];
                                option.name = year_tuple[1];
                                yearSelector.appendChild(option);
                        });
                        yearsDiv.appendChild(yearSelector);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        }
        function radioMakes() {
            const selectedMake = document.querySelector('input[name="carMake"]:checked');
            if (selectedMake) {
                const makeValue = selectedMake.value;

                // Send a request to the server to retrieve data from the database
                fetch(`http://127.0.0.1:5000/car/models/${makeValue}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Car Models:', data);
                        // Display the result
                        const modelDiv = document.getElementById('modelDiv');
                        modelDiv.innerHTML = '<H2>Select Model:</H2>';
                        const modelSelector = document.createElement('select');
                        modelSelector.onchange = addCarYears;
                        modelSelector.onclick = addCarYears;
                        modelSelector.id = 'modelSelector';
                        //const modelSelector.onclick = function to populate years which you need to write;
                        data.forEach(model => {
                            // add options to modelSelector
                            const option = document.createElement('option');
                            option.innerText = model;
                            modelSelector.appendChild(option);
                        });
                        modelDiv.appendChild(modelSelector);
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                alert('Please select a car make.');
            }
        }
        function addCarMakes() {
            fetch('http://127.0.0.1:5000/car/makes')  // Update the URL to your endpoint
                .then(response => response.json())
                .then(data => {
                    // Handle the JSON data here
                    console.log('Car Makes:', data);

            // Example: Create checkboxes dynamically
            const checkboxContainer = document.getElementById('makes_div');
            checkboxContainer.innerHTML = '';

            data.forEach(make => {
                const checkbox = document.createElement('input');
                checkbox.type = 'radio';
                checkbox.name = 'carMake';
                checkbox.value = make;
                checkbox.onclick = radioMakes; 

                const label = document.createElement('label');
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(make));

                checkboxContainer.appendChild(label);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
}
        function displayCar() {
            const selectedMake = document.querySelector('input[name="carMake"]:checked');
            var selectElement = document.getElementById("modelSelector");
            var yearSelectElement = document.getElementById("yearSelector")
            // Get the selected option
            var selectedOption = selectElement.options[selectElement.selectedIndex];
            var selectedYearOption = yearSelectElement.options[yearSelectElement.selectedIndex];

            var selectedModel = selectedOption.text;
            var selectedYear = selectedYearOption.text;
            //We dumped the sql db id onto the year option name
            var selectedCarID = selectedYearOption.name;

            if (selectedMake) {
                const makeValue = selectedMake.value;
                //fetch(`http://127.0.0.1:5000/car/${makeValue}/${selectedModel}/${selectedYear}`) // Update the URL to your endpoint
                fetch(`http://127.0.0.1:5000/car/${selectedCarID}`)
                    .then(response => response.json())
                    .then(data => {
                        // Handle the JSON data here
                        console.log('Car Details:', data);
                        data.forEach(car => {
                                handleImageData(car)
                        });
                        yearsDiv.appendChild(yearSelector);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }
        }

        async function handleImageData(data) {
            // Assuming data is an array of image URLs
            // You can customize this function based on the actual structure of your data
            const imageContainer = document.getElementById('imageContainer');

            // Clear previous content
            imageContainer.innerHTML = '';

            for (let i = 0; i < data.images.length; i++) {
                // Iterate through the array of image URLs and create image elements
                let imageUrl = data.images[i];
                if (imageUrl.length > 0) {
                    let results = await fetchB64Image(imageUrl);
                    let b64_img = results[0];
                    let image_type = results[1];
                    if (b64_img.length > 0) {
                        let base64Data = "data:image/"+image_type+";base64," + b64_img;
                        let imgElement = document.createElement("img");
                        imgElement.src = base64Data;
                        document.body.appendChild(imgElement);
                        imageContainer.appendChild(imgElement);
                    }
                }
            }
        }        
            
    async function import_delete_car_by_id(carId) {
        console.log("entering delete car by id");
        try {
            var yearSelectElement = document.getElementById("yearSelector");
            var selectedYearOption = yearSelectElement.options[yearSelectElement.selectedIndex];
            var selectedYear = selectedYearOption.text;
            //We dumped the sql db id onto the year option name
            var selectedCarID = selectedYearOption.name;
            const response = await fetch(`http://127.0.0.1:5000/car/delete/${selectedCarID}`);
            const result = await response.json();
        } catch (error) {
            console.error('Error deleting car:', error);
        }
    }
     
    async function fetchB64Image(image_name) {
            try {
                let image_url = "http://127.0.0.1:5000/getimage/" + image_name;
                console.log("Fetching image:", image_url);
                const response = await fetch(image_url);
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                const data = await response.json();
                if (data.success) {
                    console.log('b64 image fetch success, result:', data.message);
                    return [data.base64_data, data.image_type];
                } else {
                    console.log('b64 image fetch failed result:', data.message);
                    return ["", ""];
                }
            }
            catch(error) {
                console.error('Fetch Error:', error);
            }
        }
                
        function searchOrCreateData() {
            // Get selected values from dropdowns
            const make = document.getElementById("make").value;
            const year = document.getElementById("year").value;
            const model = document.getElementById("model").value;
            const images = document.getElementById("images").files;
            const paintColor = document.getElementById("paintColor").value;
            const price = document.getElementById("price").value;
            

            // Perform search or create data logic here
            console.log("Make:", make);
            console.log("Year:", year);
            console.log("Model:", model);
            console.log("Images:", images);
            console.log("Paint Color:", paintColor);
            console.log("Price", price);
            // Add your logic to handle the selected values and perform the desired actions
            }
            
            
            function addCar() {
                    // Sample card data
                    const cardData = {
                            make: "Toyota",
                            model: "Camry",
                            year: 2022,
                            notes: "Sample notes",
                            color: "Blue",
                            type: "Sedan",
                            images: ["base64_image1", "base64_image2"]
                        };

                // Endpoint URL
                const endpointUrl = "http://127.0.0.1:5000/add_car";

                // Make a POST request using fetch
                fetch(endpointUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(cardData),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    // Handle the response data as needed
                })
                .catch((error) => {
                    console.error('Error:', error);
                    // Handle errors
                });
        }
        



        function validateForm() {
            var x = document.forms["myImages"]["image_name"].value;
            if (x == "") {
            alert("Name must be filled out");
                return false;
            }
        }
            // Get the button element by its ID
            var button = document.getElementById('contact_btn');
    
            // Add a click event listener to the button
            button.addEventListener('click', function() {
            // Set the new URL you want to navigate to
            var newUrl = 'contact_us.html';
    
            // Change the window location to the new URL
            window.location.href = newUrl;
            });
        addCarMakes();
        </script>
</section>
</body>
</html>